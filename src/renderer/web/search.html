<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width,initial-scale=1" />
		<!-- <meta name="generator" content="mze" /> -->
		<title>mze</title>
		<link rel="icon" href="data:;base64,iVBORw0KGgo=">
<style>

.search_bar {
	display: flex;
	justify-content: center;
}

.search_bar .search_box {
	max-width: 30em;
	flex: 100px;
}

.search_box {
	font-size: 2em;
}

.search_results_tags, .search_results_attributes, .search_results_records_and_links {
	display: flex;
}

article.search_result {
	section.info {
	}

	section.tags {
	}

	section.attributes {
	}

	section.record_data {
	}

	section.link_from_to {
	}
}

</style>
<script>

const search_url = "/search";

window.addEventListener("load", (e) => {
	const search_box = document.getElementsByClassName("search_box")[0];
	search_box.addEventListener("input", updateSearchResults);
	updateSearchResults(e);
});

// TODO handle concurrent queries properly by cancelling the in-progress search
// and executing a new one
async function updateSearchResults(e) {
	const search_box = document.getElementsByClassName("search_box")[0];

	const search_params = new URLSearchParams({
		q: search_box.value,
	});
	const url = search_url + "?" + search_params.toString();
	console.log("123");
	try {
		const response = await fetch(url);
		if (!response.ok) {
			console.error(`Error: url=${url} response.status=${response.status}`);
		}
		const json = await response.json();
		console.log(json)
		document
			.getElementsByClassName("search_interpretation")[0]
			.innerHTML = json.search_interpretation;
		document
			.getElementsByClassName("search_results_tags")[0]
			.innerHTML = json.search_results.search_results_tags;
		document
			.getElementsByClassName("search_results_attributes")[0]
			.innerHTML = json.search_results.search_results_attributes;
		document
			.getElementsByClassName("search_results_records_and_links")[0]
			.innerHTML = json.search_results.search_results_records_and_links;
	} catch (error) {
		console.error(`Error: error.message=${error.message}`);
	}
}

</script>
	</head>
	<body>
		<nav>
		</nav>
		<main>
			<div class="search_bar">
				<input type="text" class="search_box">
			</div>
			<div class="search_interpretation">
				<!-- how mze interprets the search query -->
			</div>
			<div class="search_results_tags">
			</div>
			<div class="search_results_attributes">
			</div>
			<div class="search_results_records_and_links">
			</div>
		</main>
	</body>
</html>
